<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel Trabajador</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <header>
        <h1>Panel Trabajador</h1>
        <div id="bienvenida"></div>
        <button id="btnCerrarSesion">Cerrar Sesión</button>
    </header>

    <section id="resumen" class="resumen">
        <h2>Resumen de Créditos</h2>
        <div class="resumen-grid">
            <div>Total de Créditos: <span id="totalCreditosTrabajador">0</span></div>
            <div>Créditos Vigentes: <span id="creditosVigentesTrabajador">0</span></div>
            <div>Créditos Vencidos: <span id="creditosVencidosTrabajador">0</span></div>
            <div>Deuda Total: <span id="deudaTotalTrabajador">S/ 0.00</span></div>
            <div>Deuda Vencida: <span id="deudaVencidaTotal">S/ 0.00</span></div>
        </div>
    </section>

    <section id="clientesTabTrabajador">
        <div class="toolbar">
            <input type="text" id="buscarClienteTrabajador" placeholder="Buscar cliente (DNI o nombre)" oninput="filtrarClientes(this.value)" />
            <button onclick="exportarClientesExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
        </div>
        <div class="table-container">
            <table id="clientesTableTrabajador">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>DNI</th>
                        <th>Nombre</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Asesor</th>
                        <th>Monto Principal</th>
                        <th>Monto Total</th>
                        <th>Saldo</th>
                        <th>Tipo</th>
                        <th>Frecuencia</th>
                        <th>DT</th>
                        <th>Cuotas</th>
                        <th>Deuda Vencida</th>
                        <th>Cuota Diaria</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Datos se cargan dinámicamente -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL: REGISTRAR CUOTA -->
    <div id="cuotaModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarModalCuota()">&times;</span>
            <h2>Registrar Cuota</h2>
            <form id="cuotaForm">
                <input type="hidden" id="cuotaPrestamoId" />
                
                <div id="cuotaSugerencia" class="sugerencia-info">
                    <i class="fas fa-info-circle"></i>
                    Ingrese el monto de la cuota
                </div>
                
                <label for="cuotaMonto">Monto de la Cuota (S/) *:</label>
                <input type="number" id="cuotaMonto" step="0.01" min="0.01" required />
                
                <label for="cuotaDescripcion">Descripción (opcional):</label>
                <input type="text" id="cuotaDescripcion" placeholder="Ej: Cuota del día, pago parcial..." />
                
                <p class="worker-info">
                    <i class="fas fa-info-circle"></i>
                    Los trabajadores pueden registrar cuotas pero no crear o eliminar clientes.
                </p>
                
                <button type="submit">Registrar Cuota</button>
            </form>
        </div>
    </div>

    <!-- MODAL: HISTORIAL DE CUOTAS -->
    <div id="historialCuotasModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarHistorialCuotas()">&times;</span>
            <h2>Historial de Cuotas</h2>
            
            <div class="historial-resumen">
                <p><strong>Total Pagado:</strong> <span id="totalPagadoCuotas">S/ 0.00</span></p>
            </div>
            
            <div class="table-container">
                <table id="historialCuotasTable">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Monto</th>
                            <th>Descripción</th>
                            <th>Estado del Pago</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Se llena dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTRAR PAGO (COMPATIBILIDAD) -->
    <div id="pagoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarModalPago()">&times;</span>
            <h2>Registrar Pago</h2>
            <form id="pagoForm">
                <input type="hidden" id="pagoPrestamoId" />
                
                <label for="pagoMonto">Monto del Pago (S/) *:</label>
                <input type="number" id="pagoMonto" step="0.01" min="0.01" required />
                
                <p class="worker-info">
                    <i class="fas fa-info-circle"></i>
                    Los trabajadores pueden registrar pagos pero no crear o eliminar clientes.
                </p>
                
                <button type="submit">Registrar Pago</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>