<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel Administrador</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <header>
        <h1>Panel Administrador</h1>
        <div id="bienvenida"></div>
        <button id="btnCerrarSesion">Cerrar Sesión</button>
    </header>

    <section id="resumen" class="resumen">
        <h2>Resumen de Créditos</h2>
        <div class="resumen-grid">
            <div>Total de Créditos: <span id="totalCreditos">0</span></div>
            <div>Créditos Vigentes: <span id="creditosVigentes">0</span></div>
            <div>Créditos Vencidos: <span id="creditosVencidos">0</span></div>
            <div>Deuda Total: <span id="deudaTotal">S/ 0.00</span></div>
        </div>
    </section>

    <nav class="tabs">
        <button class="tab-btn active" data-target="clientesTab">Clientes</button>
        <button class="tab-btn" data-target="trabajadoresTab">Trabajadores</button>
        <button class="tab-btn" data-target="historialTab">Historial de Pagos</button>
    </nav>

    <!-- PESTAÑA DE CLIENTES -->
    <section id="clientesTab" class="tab-content active">
        <div class="toolbar">
            <button onclick="abrirClienteModal()">
                <i class="fas fa-user-plus"></i> Añadir Cliente
            </button>
            <input type="text" id="buscarClienteAdmin" placeholder="Buscar cliente (DNI o nombre)" oninput="filtrarClientes(this.value)" />
            <button onclick="exportarClientesExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
        </div>
        <div class="table-container">
            <table id="clientesTableAdmin">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>DNI</th>
                        <th>Nombre</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Monto Total</th>
                        <th>Saldo</th>
                        <th>Tipo</th>
                        <th>DT</th>
                        <th>Pagos</th>
                        <th>Deuda Vencida</th>
                        <th>Cuota</th>
                        <th>Fecha Fin</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Datos se cargan dinámicamente -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- PESTAÑA DE TRABAJADORES -->
    <section id="trabajadoresTab" class="tab-content">
        <div class="toolbar">
            <button onclick="agregarTrabajador()">
                <i class="fas fa-user-tie"></i> Añadir Trabajador
            </button>
            <input type="text" id="buscarTrabajadorAdmin" placeholder="Buscar trabajador (usuario o DNI)" oninput="filtrarTrabajadores(this.value)" />
        </div>
        <div class="table-container">
            <table id="trabajadoresTableAdmin">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>DNI</th>
                        <th>Teléfono</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Datos se cargan dinámicamente -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- PESTAÑA DE HISTORIAL DE PAGOS -->
    <section id="historialTab" class="tab-content">
        <h2>Historial de Pagos</h2>
        <div class="toolbar">
            <input type="text" id="buscarHistorialInput" placeholder="Buscar historial por cliente (DNI o nombre)" oninput="buscarHistorial(this.value)" />
        </div>
        <div class="table-container">
            <table id="prestamosTableAdmin">
                <thead>
                    <tr>
                        <th>Cliente</th>
                        <th>DNI</th>
                        <th>Monto</th>
                        <th>Interés</th>
                        <th>Tipo</th>
                        <th>Fecha Inicio</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="7" class="text-center">Busca un cliente para ver su historial.</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL: AGREGAR CLIENTE Y PRÉSTAMO INICIAL -->
    <div id="clienteModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarClienteModal()">&times;</span>
            <h2 id="clienteModalTitle">Añadir Cliente y Préstamo</h2>
            <form id="clienteForm">

                <h3>Datos del Cliente</h3>
                <label for="clienteNombreInput">Nombre completo *:</label>
                <input type="text" id="clienteNombreInput" required />

                <label for="clienteDniInput">DNI *:</label>
                <input type="text" id="clienteDniInput" required />

                <label for="clienteLugarInput">Dirección:</label>
                <input type="text" id="clienteLugarInput" />

                <label for="clienteTelefonoInput">Teléfono:</label>
                <input type="text" id="clienteTelefonoInput" />

                <h3>Datos del Préstamo Inicial</h3>
                <label for="prestamoMontoInput">Monto (S/) *:</label>
                <input type="number" id="prestamoMontoInput" step="0.01" min="0" required />

                <label for="prestamoInteresInput">Interés (%) *:</label>
                <input type="number" id="prestamoInteresInput" step="0.01" min="0" required />

                <label for="prestamoTipoInput">Tipo de Préstamo *:</label>
                <select id="prestamoTipoInput" required>
                    <option value="">Seleccione un tipo</option>
                    <option value="Diario">Diario</option>
                    <option value="Semanal">Semanal</option>
                    <option value="Quincenal">Quincenal</option>
                    <option value="Mensual">Mensual</option>
                </select>

                <label for="prestamoCuotaInput">Cuota (S/) *:</label>
                <input type="number" id="prestamoCuotaInput" step="0.01" min="0" required />

                <label for="prestamoFechaInicioInput">Fecha de Inicio *:</label>
                <input type="date" id="prestamoFechaInicioInput" required />

                <button type="submit" id="clienteSubmitBtn">Guardar Cliente y Préstamo</button>
            </form>
        </div>
    </div>

    <!-- MODAL: EDITAR CLIENTE -->
    <div id="editClienteModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarEditClienteModal()">&times;</span>
            <h2>Editar Cliente</h2>
            <form id="editClienteForm">
                <input type="hidden" id="editClienteId" />

                <label for="editClienteNombre">Nombre *:</label>
                <input type="text" id="editClienteNombre" required />

                <label for="editClienteDireccion">Dirección:</label>
                <input type="text" id="editClienteDireccion" />

                <label for="editClienteTelefono">Teléfono:</label>
                <input type="text" id="editClienteTelefono" />

                <button type="submit">Actualizar Cliente</button>
            </form>
        </div>
    </div>

    <!-- MODAL: AGREGAR NUEVO PRÉSTAMO -->
    <div id="prestamoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarPrestamoModal()">&times;</span>
            <h2>Añadir Nuevo Préstamo</h2>
            <form id="prestamoForm">
                <input type="hidden" id="prestamoClienteId" />

                <label for="prestamoMontoNuevo">Monto (S/) *:</label>
                <input type="number" id="prestamoMontoNuevo" step="0.01" min="0" required />

                <label for="prestamoInteresNuevo">Interés (%) *:</label>
                <input type="number" id="prestamoInteresNuevo" step="0.01" min="0" required />

                <label for="prestamoTipoNuevo">Tipo de Préstamo *:</label>
                <select id="prestamoTipoNuevo" required>
                    <option value="">Seleccione un tipo</option>
                    <option value="Diario">Diario</option>
                    <option value="Semanal">Semanal</option>
                    <option value="Quincenal">Quincenal</option>
                    <option value="Mensual">Mensual</option>
                </select>

                <label for="prestamoCuotaNuevo">Cuota (S/) *:</label>
                <input type="number" id="prestamoCuotaNuevo" step="0.01" min="0" required />

                <label for="prestamoFechaInicioNuevo">Fecha de Inicio *:</label>
                <input type="date" id="prestamoFechaInicioNuevo" required />

                <button type="submit">Guardar Préstamo</button>
            </form>
        </div>
    </div>

    <!-- MODAL: AGREGAR/EDITAR TRABAJADOR -->
    <div id="workerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarModal()">&times;</span>
            <h2 id="modalTitle">Añadir Trabajador</h2>
            <form id="workerForm">
                <input type="hidden" id="workerId" />
                
                <label for="usernameInput">Usuario *:</label>
                <input type="text" id="usernameInput" required />
                
                <label for="dniInput">DNI:</label>
                <input type="text" id="dniInput" />
                
                <label for="telefonoInput">Teléfono:</label>
                <input type="text" id="telefonoInput" />
                
                <label for="passwordInput">Contraseña *:</label>
                <div class="password-container">
                    <input type="password" id="passwordInput" required />
                    <button type="button" id="togglePassword" onclick="togglePasswordVisibility()">
                        <img id="passwordIcon" src="{{ url_for('static', filename='icons/eye-open.svg') }}" 
                             alt="Mostrar contraseña" width="20" height="20">
                    </button>
                </div>
                
                <button type="submit" id="submitBtn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- MODAL: REGISTRAR PAGO -->
    <div id="pagoModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarModalPago()">&times;</span>
            <h2>Registrar Pago</h2>
            <form id="pagoForm">
                <input type="hidden" id="pagoPrestamoId" />
                
                <label for="pagoMonto">Monto del Pago (S/) *:</label>
                <input type="number" id="pagoMonto" step="0.01" min="0.01" required />
                
                <button type="submit">Registrar Pago</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>